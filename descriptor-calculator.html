<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>x86 描述符计算器</title>
    <link rel="stylesheet" href="static/css/descriptor.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>x86 描述符计算器</h1>
        </header>
        
        <div class="settings-panel">
            <h2 class="section-title">描述符参数</h2>
            
            <div class="form-group">
                <label>描述符类型:</label>
                <div class="segment-type-selector">
                    <div class="segment-type-option active" data-type="app">应用程序 (代码/数据)</div>
                    <div class="segment-type-option" data-type="sys">系统 (IDT/门/TSS等)</div>
                </div>
            </div>
            
            <!-- 应用程序段参数 -->
            <div id="appsegs" class="app-params">
                <div class="param-row">
                    <div class="form-group">
                        <label for="base">基地址 (Base):</label>
                        <input type="text" id="base" value="0x00000000" maxlength="10">
                        <div class="field-description">32位线性地址</div>
                    </div>
                    <div class="form-group">
                        <label for="limit">界限 (Limit):</label>
                        <input type="text" id="limit" value="0xFFFFF" maxlength="7">
                        <div class="field-description">段的大小-1 (字节)</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>应用程序段类型:</label>
                    <div class="app-seg-type-selector">
                        <div class="app-seg-type-option active" data-type="data">数据段</div>
                        <div class="app-seg-type-option" data-type="code">代码段</div>
                    </div>
                </div>
                
                <!-- 应用程序段特定参数 -->
                <div class="app-seg-params-container">
                    <!-- 第一行：代码段/数据段特定参数 + 通用参数 -->
                    <div class="first-row-params">
                        <!-- 数据段参数 -->
                        <div id="data-seg-params">
                            <div class="checkbox-group">
                                <input type="checkbox" id="expand">
                                <label for="expand">向下扩展 (Expand Down)</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="writable">
                                <label for="writable">可写 (Writable)</label>
                            </div>
                        </div>
                        
                        <!-- 代码段参数 -->
                        <div id="code-seg-params" style="display:none">
                            <div class="checkbox-group">
                                <input type="checkbox" id="conforming">
                                <label for="conforming">一致段 (Conforming)</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="readable" checked>
                                <label for="readable">可读 (Readable)</label>
                            </div>
                        </div>
                        
                        <!-- 通用参数 -->
                        <div class="checkbox-group">
                            <input type="checkbox" id="accessed">
                            <label for="accessed">已访问 (Accessed)</label>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="granularity" checked>
                            <label for="granularity">粒度 (Granularity, 1=4KB, 0=1B)  </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 系统段参数 -->
            <div id="syssegs" class="sys-params" style="display:none">
                <div id="seloffs" class="param-row">
                    <div class="form-group">
                        <label for="sel">选择子 (Selector):</label>
                        <input type="text" id="sel" value="0x0000">
                    </div>
                    <div class="form-group">
                        <label for="offset">偏移量 (Offset):</label>
                        <input type="text" id="offset" value="0x00000000">
                    </div>
                </div>
                
                <div id="baseoffs" class="param-row" style="display:none">
                    <div class="form-group">
                        <label for="base_tss">基地址 (Base):</label>
                        <input type="text" id="base_tss" value="0x00000000" maxlength="10">
                    </div>
                    <div class="form-group">
                        <label for="limit_tss">界限 (TSS大小):</label>
                        <input type="text" id="limit_tss" value="134" maxlength="7">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="systypes">系统段类型:</label>
                    <select id="systypes">
                        <option value="0">无效0 (Invalid0)</option>
                        <option value="1">286 可用TSS (286 Available TSS)</option>
                        <option value="2">本地描述符表 (Local Descriptor Table)</option>
                        <option value="3">286 忙TSS (286 Busy TSS)</option>
                        <option value="4">286 调用门 (286 Call Gate)</option>
                        <option value="5">任务门 (Task Gate)</option>
                        <option value="6">286 中断门 (286 Interrupt Gate)</option>
                        <option value="7">286 陷阱门 (286 Trap Gate)</option>
                        <option value="8">无效8 (Invalid8)</option>
                        <option value="9">386 可用TSS (386 Available TSS)</option>
                        <option value="10">无效A (InvalidA)</option>
                        <option value="11">386 忙TSS (386 Busy TSS)</option>
                        <option value="12">386 调用门 (386 Call Gate)</option>
                        <option value="13">无效D (InvalidD)</option>
                        <option value="14">386 中断门 (386 Interrupt Gate)</option>
                        <option value="15">386 陷阱门 (386 Trap Gate)</option>
                    </select>
                </div>
                
                <div id="callgate" style="display:none">
                    <div class="form-group">
                        <label for="params">调用门参数数量 (0-31):</label>
                        <input type="text" id="params" value="0">
                    </div>
                </div>
                
                <!-- 系统段通用参数 -->
                <div class="first-row-params">
                    <div class="checkbox-group">
                        <input type="checkbox" id="accessed_sys">
                        <label for="accessed_sys">已访问 (Accessed)</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="granularity_sys" checked>
                        <label for="granularity_sys">粒度 (Granularity, 1=4KB, 0=1B) </label>
                    </div>
                </div>
            </div>
            
            <!-- 第二行：DPL和三个复选框 -->
            <div class="second-row-params">
                <div class="second-row-item dpl-container">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="dpl">描述符特权级 (DPL):</label>
                        <input type="text" id="dpl" class="dpl-input" value="0">
                        <div class="field-description" style="margin-top: 5px;">0-3 (0为最高特权)</div>
                    </div>
                </div>
                
                <div class="second-row-item checkbox-container">
                    <input type="checkbox" id="present" checked>
                    <label for="present">存在 (Present)</label>
                </div>
                
                <div class="second-row-item checkbox-container">
                    <input type="checkbox" id="avl">
                    <label for="avl">可用位 (Available bit)</label>
                </div>
                
                <div class="second-row-item checkbox-container">
                    <input type="checkbox" id="sz" checked>
                    <label for="sz">32位模式 (32-bit) </label>
                </div>
            </div>
            
            <div id="message-area" class="message-area"></div>
        </div>
        
        <div class="results-panel">
            <h2 class="section-title">描述符计算结果</h2>
            
            <div class="result-section">
                <h3>描述符值 (8字节)</h3>
                
                <div class="result-format">
                    <span class="result-label">双字 (dd):</span>
                    <div class="result-value">
                        <span id="dwords" class="hex-display">0x00000000, 0x00000000</span>
                    </div>
                </div>
                
                <div class="result-format">
                    <span class="result-label">字 (dw):</span>
                    <div class="result-value">
                        <span id="words" class="hex-display">0x0000, 0x0000, 0x0000, 0x0000</span>
                    </div>
                </div>
                
                <div class="result-format">
                    <span class="result-label">字节 (db):</span>
                    <div class="result-value">
                        <span id="bytes" class="hex-display">0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00</span>
                    </div>
                </div>
            </div>
            
            <div class="result-section">
                <h3>描述符结构可视化</h3>
                <div class="descriptor-visual">
                    <div id="byte-visualization" style="width:100%; text-align:center; padding:20px;">
                        修改参数以查看描述符结构
                    </div>
                </div>
            </div>
        </div>
        
        <div class="analysis-panel">
            <h2 class="section-title">字段解析</h2>
            
            <div id="field-analysis" class="field-analysis-grid">
                <div class="field-item">
                    <div class="field-name">基地址 (Base)</div>
                    <div class="field-value" id="field-base">0x00000000</div>
                    <div class="field-bits">位 16-39, 56-63</div>
                    <div class="field-description-text">段的起始线性地址</div>
                </div>
                
                <div class="field-item">
                    <div class="field-name">界限 (Limit)</div>
                    <div class="field-value" id="field-limit">0x000FFFFF</div>
                    <div class="field-bits">位 0-15, 48-51</div>
                    <div class="field-description-text">段的大小-1 (字节)</div>
                </div>

                <div class="field-item">
                    <div class="field-name">段长度</div>
                    <div class="field-value" id="field-length">0 B</div>
                    <div class="field-bits">-</div>
                    <div class="field-description-text">根据段界限、粒度和扩展方向计算的段总长度</div>
                </div>
                
                <div class="field-item">
                    <div class="field-name">类型 (Type)</div>
                    <div class="field-value" id="field-type">0x0 (数据段)</div>
                    <div class="field-bits">位 40-43</div>
                    <div class="field-description-text" id="field-type-desc">描述符类型和属性</div>
                </div>
                
                <div class="field-item">
                    <div class="field-name">描述符特权级 (DPL)</div>
                    <div class="field-value" id="field-dpl">0</div>
                    <div class="field-bits">位 45-46</div>
                    <div class="field-description-text">描述符特权级别 (0-3)</div>
                </div>
                
                <div class="field-item">
                    <div class="field-name">存在位 (P)</div>
                    <div class="field-value" id="field-present">1 (存在)</div>
                    <div class="field-bits">位 47</div>
                    <div class="field-description-text">段是否存在于内存中</div>
                </div>
                
                <div class="field-item">
                    <div class="field-name">粒度 (G)</div>
                    <div class="field-value" id="field-granularity">1 (4KB)</div>
                    <div class="field-bits">位 55</div>
                    <div class="field-description-text">界限的粒度 (0=1字节, 1=4KB)</div>
                </div>
                
                <div class="field-item">
                    <div class="field-name">默认操作大小 (D/B)</div>
                    <div class="field-value" id="field-size">1 (32位)</div>
                    <div class="field-bits">位 54</div>
                    <div class="field-description-text">默认操作数大小 (0=16位, 1=32位)</div>
                </div>
                
                <div class="field-item">
                    <div class="field-name">可用位 (AVL)</div>
                    <div class="field-value" id="field-avl">0</div>
                    <div class="field-bits">位 52</div>
                    <div class="field-description-text">可供系统软件使用</div>
                </div>
            </div>
        </div>
    </div>

    <script src="static/js/descriptor.js"></script>
</body>
</html>
